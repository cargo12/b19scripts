#!/bin/bash
# bb v0.5 last mod 2014/03/11
# Latest version at <http://bit.ly/breakboot>
# Copyright 2012,2013 Ryan Sawhill Aroha <rsaw@redhat.com>
#
#    This program is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    This program is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
#    General Public License <gnu.org/licenses/gpl.html> for more details.
#
# In fact, this program's sole purpose is to cause boot problems on a RHEL 6
# system, in order to give you practice at fixing such problems.
# Use at your own risk and preferably on a virtual machine.
#-------------------------------------------------------------------------------

# Colors
reset='\033[0;0m'
bold='\033[1;1m'
red='\033[1;31m'

# Location of breakboot configs
cfgfile=/root/.breakboot
fixfile=/root/.breakboot_fix

for i in /etc/sysconfig/{authconfig,network,sshd}; do . $i 2>/dev/null; done
RR=$(awk {print\$2\$4\$3\$1} /etc/[rza]*[-mpq]re*)
L=$(lsb_release -sr)
p=$(cat /tmp/.bbpass 2>/dev/null)
[[ -z $p ]] && p="${L:0:1}$RR$USENIS$NETWORKING$AUTOCREATE_SERVER_KEYS"
functions=$(mktemp -p /dev/shm) && trap "rm $functions 2>/dev/null" EXIT
openssl aes-128-cbc -md sha256 -k "$p" -a -d <<\EOF | zcat >$functions
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
ymHL9QCViZ8LGXYRQvdq0g==
EOF

. $functions

USAGE() {
  printf "${bold}Usage: ${0##*/} { 1-10 | next | skip | lesson [1-10|all] | fix }${reset}
  • ${bold}1${reset} thru ${bold}10${reset} to setup a specific exercise
  • ${bold}next${reset} to setup the next exercise
  • ${bold}skip${reset} to skip next exercise and setup the one after it
  • ${bold}lesson${reset} to see the lessons for the current exercise
  \n"
}

if [[ -z $1 ]]; then
  USAGE
else  
  case "$1" in
    next|skip|fix|1|2|3|4|5|6|7|8|9|10)
      if [[ $UID == 0 ]]; then
        break_fix "$@"
      else
        echo "Sorry, but you're going to have to run this as root"
        exit 1
      fi
  ;;
    lesson)
      if [[ -n $2 ]] && ! egrep -qs '^([1-9]|1[0]|all)$' <<<"$2"; then
        USAGE
      else
        break_fix "$@"
      fi
  ;;
    *)
      USAGE
  esac
fi
